import sys
import os

# Add the project root to the Python path
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '../../')))

import ollama
import json

from src.utils.prompt import SYSTEM_PROMPT

class EventExtractor:
    def __init__(self, model_name="qwen2.5:3b"):
        self.model = model_name

    def process_post(self, text):
        response = ollama.chat(
            model=self.model,
            messages=[
                {"role": "system", "content": SYSTEM_PROMPT},
                {"role": "user", "content": f"–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞:\n{text}"},
            ],
            format="json",
        )

        return json.loads(response["message"]["content"])


example_post = """\
#–ö—É–ª—å—Ç—É—Ä–∞
–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –º—É–∑–µ–π–Ω–∞—è –Ω–µ–¥–µ–ª—è –≤ –º—É–∑–µ–µ-–∑–∞–ø–æ–≤–µ–¥–Ω–∏–∫–µ ¬´–ö–æ–ª–æ–º–µ–Ω—Å–∫–æ–µ¬ª
üìÖ 13.02.2026
üìç –º—É–∑–µ–π-–∑–∞–ø–æ–≤–µ–¥–Ω–∏–∫ ¬´–ö–æ–ª–æ–º–µ–Ω—Å–∫–æ–µ¬ª

–í –ø—è—Ç–Ω–∏—Ü—É, 13 —Ñ–µ–≤—Ä–∞–ª—è, –≤ —Ä–∞–º–∫–∞—Ö –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –º—É–∑–µ–π–Ω–æ–π –Ω–µ–¥–µ–ª–∏ –º–æ–∂–Ω–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–æ—Å–µ—Ç–∏—Ç—å –º—É–∑–µ–π-–∑–∞–ø–æ–≤–µ–¥–Ω–∏–∫ ¬´–ö–æ–ª–æ–º–µ–Ω—Å–∫–æ–µ¬ª. –í–∞—Å –∂–¥—É—Ç 8 –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ 7 –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —ç–∫—Å–ø–æ–∑–∏—Ü–∏–π, –∞ —Ç–∞–∫–∂–µ —ç–∫—Å–∫—É—Ä—Å–∏–∏ –ø–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –∏ –≤–Ω—É—Ç—Ä–∏ –º—É–∑–µ—è-–∑–∞–ø–æ–≤–µ–¥–Ω–∏–∫–∞.

–î—Ä—É–∑—å—è, –∂–¥—ë–º –≤–∞—Å —Å–µ–≥–æ–¥–Ω—è –≤ 19:00 –Ω–∞ –Ω–∞—à—É —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫—É—é –≤—Å—Ç—Ä–µ—á—É. –ö–∞–∫ –æ–±—ã—á–Ω–æ, –±—É–¥–µ–º —Å–æ–≤–º–µ—Å—Ç–Ω–æ —á–∏—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç –∏ –æ–±—Å—É–∂–¥–∞—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ. 

–í —á–µ—Å—Ç—å –Ω–∞—Å—Ç—É–ø–∞—é—â–µ–≥–æ 14 —Ñ–µ–≤—Ä–∞–ª—è ‚Äî —Ç–µ–º–∞ –≤–µ—á–µ—Ä–∞ –≠—Ä–∏—Ö –§—Ä–æ–º–º –∏ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –≥–ª–∞–≤—ã –∏–∑ –µ–≥–æ —Ä–∞–±–æ—Ç—ã ¬´–ò—Å–∫—É—Å—Å—Ç–≤–æ –ª—é–±–∏—Ç—å¬ª. 

–ú—ã –∂–¥—ë–º –≤—Å–µ—Ö, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —É—Ä–æ–≤–Ω—è –≤–∞—à–µ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏. –¢–µ–∫—Å—Ç –ø–æ–¥–æ–π–¥–µ—Ç –∫–∞–∫ —Ç–µ–º, –∫—Ç–æ –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è —Å —Ñ–∏–ª–æ—Å–æ—Ñ–∏–µ–π –ª–∏—à—å –≤ –≤—É–∑–µ, —Ç–∞–∫ –∏ —Ç–µ–º, –∫—Ç–æ —É–∂–µ —á–∏—Ç–∞–ª –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç. 

–ü–æ—Å–µ—â–µ–Ω–∏–µ ‚Äî –ø–æ —Ç–∞—Ä–∏—Ñ—É –¶–∏—Ñ–µ—Ä–±–ª–∞—Ç–∞ –±–µ–∑ –¥–æ–ø–ª–∞—Ç.
–ï—Å–ª–∏ —É –≤–∞—Å –æ—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã, –ø–∏—à–∏—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é @Lettushka
"""
print(EventExtractor(model_name="qwen2.5:1.5b").process_post(example_post))
